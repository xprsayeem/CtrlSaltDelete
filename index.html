<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Ctrl+Salt+Delete - Character Select</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="assets/pics/snow.png">
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script defer src="https://cloud.umami.is/script.js" data-website-id="4ec4bed3-5367-4fac-8ff6-2e96d8362399"></script>
</head>
<body>
  <!-- Full Screen -->
  <div class="desktop">
    <!-- Taskbar -->
    <div class="xp-taskbar">
      <!-- Start Button -->
      <div class="start-button" id="start-button" role="button">
        <span class="start-logo">‚ùÑ</span>
        <span>Start</span>
      </div>
      <!-- Ctrl+Salt+Delete and About minimized windows -->
      <div class="taskbar-items">
        <div class="taskbar-item active">Ctrl+Salt+Delete</div>
        <div class="about-button" id="taskbar-item-about" role="button">About</div>
      </div>
      <!-- System Tray -->
      <div class="system-tray">
        <span><button class="mute-toggle" type="button" aria-label="Toggle sound"></button></span> 
        <span>üì∂</span>
        <span class="clock">2:47 PM</span>
      </div>
    </div>

    <!-- Game Window -->
    <div class="game-window">
      <header class="game-titlebar">
        <div class="game-title-left">
          <span class="game-icon"></span>
          <span class="game-title-text">Ctrl+Salt+Delete - Character Select</span>
        </div>        
        <div class="game-title-controls">
          <button class="ctrl-dot ctrl-dot-min" type="button" aria-label="Minimize window"></button>
          <button class="ctrl-dot ctrl-dot-max" type="button" aria-label="Maximize window"></button>
          <button class="ctrl-dot ctrl-dot-close" type="button" aria-label="Close window"></button>
        </div>
      </header>

      <main class="game-content">
        <!-- Left side: character select -->
        <section class="character-section">
          <div class="char-tabs">
            <button class="char-tab" data-char="Sayeem">Player 1: Sayeem</button>
            <button class="char-tab" data-char="Kazi">Player 2: Kazi</button>
            
            <div class="game-meta">
              <span class="meta-fps">FPS: 60</span>
              <button class="meta-save-slot active" type="button" data-slot="1">
                Save Slot 1: Your driveway
              </button>
              <button class="meta-save-slot" type="button" data-slot="2">
                Save Slot 2: Parents' driveway
              </button>
            </div>
          </div>

          <div class="char-main">
            <div class="char-viewport">
                <model-viewer
                  id="charModel"
                  src="assets/models/sayeem.glb"
                  autoplay
                  auto-rotate
                  rotation-per-second="15deg"
                  camera-controls
                  disable-zoom
                  exposure="1.1"
                  shadow-intensity="0.4"
                  alt="Character preview"
                ></model-viewer>
            </div>

            <!-- Stats for Sayeem -->
            <div class="char-stats" data-char="Sayeem">
              <h2 class="char-name">Sayeem</h2>
              <p class="char-role">Role: Driveway Dynamo</p>

              <div class="stat-row">
                <span>Power</span>
                <div class="stat-bar">
                  <div class="stat-fill" style="--fill-width: 95%;"></div>
                </div>
              </div>

              <div class="stat-row">
                <span>Speed</span>
                <div class="stat-bar">
                  <div class="stat-fill" style="--fill-width: 90%;"></div>
                </div>
              </div>

              <div class="stat-row">
                <span>Reliability</span>
                <div class="stat-bar">
                  <div class="stat-fill" style="--fill-width: 100%;"></div>
                </div>
              </div>

              <p class="char-flavor">
                Prefers early mornings, will shovel while you are still in bed.
              </p>
            </div>

            <!-- Stats for Kazi -->
            <div class="char-stats" data-char="Kazi">
              <h2 class="char-name">Kazi</h2>
              <p class="char-role">Role: Sidewalk Specialist</p>

              <div class="stat-row">
                <span>Power</span>
                <div class="stat-bar">
                  <div class="stat-fill" style="--fill-width: 90%;"></div>
                </div>
              </div>

              <div class="stat-row">
                <span>Speed</span>
                <div class="stat-bar">
                  <div class="stat-fill" style="--fill-width: 90%;"></div>
                </div>
              </div>

              <div class="stat-row">
                <span>Reliability</span>
                <div class="stat-bar">
                  <div class="stat-fill" style="--fill-width: 100%;"></div>
                </div>
              </div>

              <p class="char-flavor">
                Calm in blizzards, keeps paths clean and steps safe.
              </p>
            </div>
          </div>

          <div class="char-buttons">
            <button class="btn btn-primary">Select player</button>
            <button class="btn btn-secondary">Back</button>
          </div>
        </section>

        <!-- Right side: HUD panels -->
        <section class="info-section">
          <!-- Mission briefing -->
          <article class="hud-panel hud-mission">
            <header class="hud-header">Mission Briefing</header>
            <div class="hud-body">
              <p class="hud-objective">
                Objective: Keep your driveway, walkways, and car snow-free all winter in Oshawa
              </p>
              <ul class="hud-list">
                <li>Reward: Safe steps, clean car, clear driveway</li>
                <li>Party: Two cousins, one snow blower, unlimited shoveling energy</li>
              </ul>
            </div>
          </article>

          <!-- Loadout & Pricing -->
          <article class="hud-panel hud-services">
            <header class="hud-header">Loadout & Pricing</header>
            <div class="hud-body">
              <h3 class="hud-subtitle">Core Abilities</h3>
              <ul class="hud-list">
                <li><strong>Loadout:</strong> Snow blower plus shovels tuned for tight corners and heavy slush.</li>
                <li><strong>Service:</strong> Clean path from curb to door to make your steps feel secure.</li>
                <li><strong>Perks:</strong> De-icing and snow removed from your cars (Free)</li>
              </ul>

              <h3 class="hud-subtitle">Typical cost</h3>
              <ul class="hud-list">
                <li>Small driveways: 30 CAD</li>
                <li>Large or long driveways: 40 to 50 CAD</li>
                <li>Boss level snowfall (25+ centimeters): quoted by photo</li>
              </ul>
            </div>
          </article>

          <!-- Contact console -->
          <article class="hud-panel hud-contact">
            <header class="hud-header">Party Invite</header>
            <div class="hud-body">
              <p class="hud-callout">
                Text Mission Control (Sayeem) a photo of your driveway to join the party.
              </p>
              <a class="btn btn-ready" href="tel:+16478063530">
                Call or text: +1 (647) 806 3530
              </a>
              <div class="hud-system-log">
                <p></p>
              </div>
            </div>
          </article>
        </section>
      </main>
    </div>
    <div class="popup-window hidden" id="aboutWindow" aria-hidden="true">
      <header class="popup-titlebar">
        <span class="popup-title">About Ctrl+Salt+Delete</span>
        <button class="popup-close" type="button" aria-label="Close">√ó</button>
      </header>
      <div class="popup-body">
        <p class="popup-text">
          Ctlr+Salt+Delete: A tale of two cousins.<br> Winter quests available all season.
        </p>
        <ul class="popup-list">
          <li><a href="https://github.com/xprsayeem" target="_blank" rel="noopener">Check out my GitHub</a></li>
          <li><a href="https://sayeem.one" target="_blank" rel="noopener">Or my personal website!</a></li>
        </ul>
        <p class="popup-footnote">
          Tip: Save this page as a shortcut if you want quick access next storm.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Audio setup
    const sfx = {
      click: new Audio("assets/sfx/click.mp3"),
      whoosh: new Audio("assets/sfx/whoosh.mp3"),
      pulse: new Audio("assets/sfx/pulse.mp3"),
      boop: new Audio("assets/sfx/boop.mp3")
    };

    sfx.click.volume = 0.5;
    sfx.whoosh.volume = 0.4;
    sfx.pulse.volume = 0.5;
    sfx.boop.volume = 0.5;

    let isMuted = false;

    function playSfx(sound) {
      if (isMuted || !sound) return;
      sound.currentTime = 0;
      sound.play().catch(() => {});
    }

    // Mute Button
    const muteToggle = document.querySelector(".mute-toggle");

    if (muteToggle) {
      muteToggle.addEventListener("click", () => {
        isMuted = !isMuted;
        muteToggle.classList.toggle("muted", isMuted);
      });
    }

    // Character Select
    const tabs = document.querySelectorAll(".char-tab");
    const statBlocks = document.querySelectorAll(".char-stats");
    
    // Misc Buttons
    const primaryButton = document.querySelector(".btn-primary");
    const secondaryButton = document.querySelector(".btn-secondary");
    const readyButton = document.querySelector(".btn-ready");

    const minButton = document.querySelector(".ctrl-dot-min");
    const maxButton = document.querySelector(".ctrl-dot-max");
    const closeButton = document.querySelector(".ctrl-dot-close");

    // Button Click sounds
    if (primaryButton) {
      primaryButton.addEventListener("click", () => {
        playSfx(sfx.pulse);
      });
    }

    if (secondaryButton) {
      secondaryButton.addEventListener("click", () => {
        playSfx(sfx.click);
      });
    }

    if (readyButton) {
      readyButton.addEventListener("click", () => {
        playSfx(sfx.pulse);
      });
    }

    if (minButton) {
      minButton.addEventListener("click", () => {
        playSfx(sfx.boop);
      });
    }

    if (maxButton) {
      maxButton.addEventListener("click", () => {
        playSfx(sfx.boop);
      });
    }    

    if (closeButton) {
      closeButton.addEventListener("click", () => {
        playSfx(sfx.boop);
      });
    }

    // Taskbar and About Popup
    const startTaskbar = document.getElementById("start-button");
    const aboutTaskbar = document.getElementById("taskbar-item-about");
    const aboutWindow = document.getElementById("aboutWindow");
    const aboutClose = aboutWindow ? aboutWindow.querySelector(".popup-close") : null;
    const aboutTitlebar = aboutWindow ? aboutWindow.querySelector(".popup-titlebar") : null;

    if (startTaskbar) {
      startTaskbar.addEventListener("click", () => {
        playSfx(sfx.pulse);
      });
    }


    function showAboutWindow() {
      if (!aboutWindow) return;
      aboutWindow.classList.remove("hidden");
      aboutWindow.setAttribute("aria-hidden", "false");
      playSfx(sfx.boop);
    }

    function hideAboutWindow() {
      if (!aboutWindow) return;
      aboutWindow.classList.add("hidden");
      aboutWindow.setAttribute("aria-hidden", "true");
      playSfx(sfx.click);
    }

    if (aboutTaskbar) {
      aboutTaskbar.addEventListener("click", showAboutWindow);
    }

    if (aboutClose) {
      aboutClose.addEventListener("click", hideAboutWindow);
    }

    let isDragging = false;
    let dragOffsetX = 0;
    let dragOffsetY = 0;

    function onDragMouseDown(e) {
      if (!aboutWindow) return;
      isDragging = true;
      const rect = aboutWindow.getBoundingClientRect();
      dragOffsetX = e.clientX - rect.left;
      dragOffsetY = e.clientY - rect.top;

      document.addEventListener("mousemove", onDragMouseMove);
      document.addEventListener("mouseup", onDragMouseUp);
      e.preventDefault();
    }

    function onDragMouseMove(e) {
      if (!isDragging || !aboutWindow) return;
      const x = e.clientX - dragOffsetX;
      const y = e.clientY - dragOffsetY;

      aboutWindow.style.left = `${x}px`;
      aboutWindow.style.top = `${y}px`;
      aboutWindow.style.right = "auto";
      aboutWindow.style.bottom = "auto";
    }

    function onDragMouseUp() {
      if (!isDragging) return;
      isDragging = false;
      document.removeEventListener("mousemove", onDragMouseMove);
      document.removeEventListener("mouseup", onDragMouseUp);
    }

    if (aboutTitlebar) {
      aboutTitlebar.addEventListener("mousedown", onDragMouseDown);
    }

    // Character Flavors
    const flavorData = {
      Sayeem: [
        "Once cleared 21 driveways in one day.",
        "Special move: Ice patch figure skating.",
        "Buff: Extra patience with wet heavy snow."
      ],
      Kazi: [
        "Clears sidewalks like a speedrun.",
        "Never misses a patch on the steps.",
        "Keeps calm during blizzard conditions."
      ]
    };

    function setRandomFlavor(charKey) {
      const block = document.querySelector(`.char-stats[data-char="${charKey}"] .char-flavor`);
      if (!block) return;
      const lines = flavorData[charKey] || [];
      if (!lines.length) return;
      const randomLine = lines[Math.floor(Math.random() * lines.length)];
      block.textContent = randomLine;
    }

    // Switching Character Models 
    const modelViewer = document.querySelector("#charModel");

    const modelSources = {
      Sayeem: "assets/models/sayeem.glb",
      Kazi: "assets/models/kazi.glb"
    };

    function activateCharacter(charKey) {
      statBlocks.forEach(block => {
        const isActive = block.dataset.char === charKey;
        block.classList.toggle("active", isActive);
      });
      setRandomFlavor(charKey);
      setCharacterModel(charKey);
    }

    function setCharacterModel(charKey) {
      if (!modelViewer) return;
      const src = modelSources[charKey];
      if (src) {
        modelViewer.src = src;
      }
    }

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const target = tab.dataset.char;
        tabs.forEach(t => t.classList.toggle("active", t === tab));
        activateCharacter(target);
        playSfx(sfx.whoosh);
      });
    });

    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        activateCharacter("Sayeem");
      });
    });
    
    // 
    const saveSlots = document.querySelectorAll(".meta-save-slot");

    saveSlots.forEach(slot => {
      slot.addEventListener("click", () => {
        saveSlots.forEach(s => s.classList.remove("active"));
        slot.classList.add("active");
        playSfx(sfx.click);
      });
    });


    // typing effect for system log
    const logParagraph = document.querySelector(".hud-system-log p");
    if (logParagraph) {
      const fullText =
        "System: E-transfer and Cash in CAD accepted.\nStatus: Available in Oshawa this winter!";
      logParagraph.textContent = "";
      let index = 0;
      const speed = 25; // milliseconds per character

      function typeNext() {
        if (index <= fullText.length) {
          logParagraph.textContent = fullText.slice(0, index);
          index += 1;
          setTimeout(typeNext, speed);
        }
      }

      typeNext();
    }

  </script>

</body>
</html>
